<html>

<head>

	<!-- Load ioBroker scripts and styles-->
	<link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
	<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

	<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="../../socket.io/socket.io.js"></script>

	<script type="text/javascript" src="../../js/translate.js"></script>
	<script type="text/javascript" src="../../lib/js/materialize.js"></script>
	<script type="text/javascript" src="../../js/adapter-settings.js"></script>

	<!-- Load our own files -->
	<link rel="stylesheet" type="text/css" href="style.css" />
	<script type="text/javascript" src="words.js"></script>

	<script type="text/javascript">
		function onViewsReady(){
			// Edit-Button-Function
			var $div = $('#views');
			var $table = $div.find('.table-values');
			var $lines = $table.find('.table-lines');
			$lines.find('a[data-command]').each(function () {
				var command = $(this).data('command');
	            if (command === 'edit') {
					$(this).on('click', function () {
						var id = $(this).data('index');
						console.log("EDIT " + id);
					});
				}
			});	
			
			// Add Views to Selectbox for LinkedView inside Toolbar
			var ViewIds = [];
			views.forEach(function(element){ ViewIds.push(element._Index); });
			$('*[data-name="ToolbarNativeViewId"]').data("options", ViewIds.join(";"));
			//values2table('toolbar', toolbar);
		}

		// This will be called by the admin adapter when the settings page loads
		function load(settings, onChange) {
			// select elements with id=key and class=value and insert value
			if (!settings) return;
			toolbar = settings.toolbar || [];
			views = settings.views || [];

			$('.value').each(function () {
				var $key = $(this);
				var id = $key.attr('id');
				if ($key.attr('type') === 'checkbox') {
					// do not call onChange direct, because onChange could expect some arguments
					$key.prop('checked', settings[id])
						.on('change', () => onChange())
						;
				} else {
					// do not call onChange direct, because onChange could expect some arguments
					$key.val(settings[id])
						.on('change', () => onChange())
						.on('keyup', () => onChange())
						;
				}
			});
			// Fill tables
			values2table('views', views, onChange, onViewsReady);
			values2table('toolbar', toolbar, onChange);
			
            // Signal to admin, that no changes yet
			onChange(false);
			// reinitialize all the Materialize labels on the page if you are dynamically adding inputs:
			if (M) M.updateTextFields();
		}

		// This will be called by the admin adapter when the user presses the save button
		function save(callback) {
			// example: select elements with class=value and build settings object
			var obj = {};
			$('.value').each(function () {
				var $this = $(this);
				if ($this.attr('type') === 'checkbox') {
					obj[$this.attr('id')] = $this.prop('checked');
				} else {
					obj[$this.attr('id')] = $this.val();
				}
			});
			// Get edited tables
			obj.toolbar = table2values('toolbar');
			obj.views = table2values('views');
			callback(obj);
		}
	</script>

</head>

<body>

	<div class="m adapter-container">
		<div class="row">
			<div class="col s12 m4 l2">
				<img src="iqontrol.png" class="logo">
			</div>
		</div>

		<div class="row">
			<div class="col s12">
				<ul class="tabs">
					<li class="tab col s4"><a href="#tab-main" class="translate active">Main settings</a></li>
					<li class="tab col s4"><a href="#tab-toolbar" class="translate">Toolbar</a></li>
					<li class="tab col s4"><a href="#tab-views" class="translate">Views</a></li>
				</ul>
			</div>

			<div id="tab-main"    class="col s12 page">
				<div class="row">
					<div class="col s12">
						<h6 class="translate sub-title">Main settings</h6>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s4">
						<input type="text" id="port" class="value"/>
						<label for="port">Port</label>
						<span class="translate">http://ip:port</span>
					</div>
				</div>
				<!--div class="row">
					<div class="col s12">
						<h6 class="translate sub-title">import/export</h6>
					</div>
					<div class="row">
					<div class="col s12">
					<div class="col s6">
						<button style="display: inline-block; margin-left: 10px;">Import</button>
					</div>
					<div class="col s6">
						<button style="display: inline-block; margin-left: 10px;">Export</button>
					</div>
				</div-->
			</div>
			
			
			<div id="tab-toolbar"    class="col s12 page">
				<div class="row">
					<div class="col s12">
						<h6 class="translate sub-title">Toolbar</h6>
					</div>
				</div>
				<div class="col s12" id="toolbar">
					<div class="row">
						<div class="col s2 m1 l1 center">
							<button title="Add device" class="table-button-add btn-floating waves-effect waves-light btn-small">
								<i class=" material-icons">add</i>
							</button>
						</div>
					</div>
					<div class="col s12 m12 l12">
						<table class="table-values" style="width: 90%;">
							<thead>
								<tr>
									<th data-name="_Index"    	style="width: 40px"  class="translate"></th>
									<th data-name="ToolbarCommonName"   style="width: 200px" class="translate">Name</th>
									<th data-name="ToolbarNativeViewIdx" style="width: 200px" class="translate">Linked Viewx</th>
									<th data-name="ToolbarNativeViewId" data-type="select" style="width: 200px" class="translate">Linked View</th>
									<th data-name="ToolbarCommonIcon" 	style="width: 200px" class="translate">Icon</th>
									<th data-buttons="delete up down"   style="width: 40px"></th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
			
			
			<div id="tab-views"    class="col s12 page">
				<div class="row">
					<div class="col s12">
						<h6 class="translate sub-title">Views</h6>
					</div>
				</div>
				<div class="col s12" id="views">
					<div class="row">
						<div class="col s2 m1 l1 center">
							<button title="Add device" class="table-button-add btn-floating waves-effect waves-light btn-small">
								<i class=" material-icons">add</i>
							</button>
						</div>
					</div>
					<div class="col s12 m12 l12">
						<table class="table-values" style="width: 90%;">
							<thead>
								<tr>
									<th data-name="_Index"    		style="width: 40px"  class="translate"></th>
									<th data-name="View_CommonName" 	style="width: 200px" class="translate">Name</th>
									<th data-name="View_Background"     style="width: 200px" class="translate">Background	</th>
									<th data-buttons="delete up down edit"   style="width: 40px"></th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>			
		</div>
	</div>
</body>

</html>